%YAML 1.2
---
KaBS:
   HOME: /home/naranjja/Devel/KaBS

   OUTPUTS: results 

   BATCH:
        # for the batch systems with a script defined, the submission command will be: <command> <parameters> <script>
        - name: LSF
          script: run.lsf.in 
          submit: 
                command: bsub 
                parameters:  < 
                submittedmsg: Job <%JOBID%> is submitted to queue 
          monitor: bjobs -u all | gawk '{print $1}' | grep %JOBID%
          numprocs: 4,8,16,32
          tasks_per_node: 8           
          queue: rh6_q20m                             
          launcher: mpirun.lsf  
          launcher_flags:    
          mpiflags: -a openmpi
          wallclock: 20       
                
        - name: MANUAL
          hostslistfile: hostnames      
          submit: 
                command: mpirun 
                parameters: -np %NUMPROCS% -machinefile %HOSTSLISTFILE%  

   TESTS: 
      APPS:
         - name: namd
           active: true
           batch: LSF     
           # following parameters are dataset dependent... 
           # This values will be used unless they are redefined in the "dataset" section 
           exe: namd2_mpi                       
           modules: module load gcc mpi-openmpi  libs-extra fftw2/2.1.5-openmpi-1.4.3-sse4.2-sp namd    
           # here goes the specific dataset configuration
           dataset: 
              - name: namd_nucleosome146Katoms
                active: true
                args: nucleosome146Katoms.namd  > nucleosome.out  2>nucleosome.err
                outputs: 
                   output: nucleosome.out                      
 				verify: 
 				references:
 
              - name: namd_apoa1  
                active: false
                args:  apoa1.namd   > apoa1.out 2>apoa1.err                        
                outputs: 
                   output: apoa1.out  
                   another_output: KaBS_%NAME%_%NUMPROCS%.out          
				verify:
				references:
                  
         - name: siesta
           active: true
           batch: LSF
           exe: siesta
           modules: module load gcc mpi-openmpi blas blacs  lapack scalapack siesta
           dataset:
              - name: siesta_test
                active: true
                args: < fen.fdf  > output.txt
                outputs:
                   clock: CLOCK
                   output: output.txt
                   fenxml: fen.xml
                   feneig: fen.EIG

      SYSTEM: 
         - name: modules
           active: false
           batch: None
           dataset:
                - name: iozone3_408
                  args: -Rab output.wks â€“g 2G  -I
                  exe: bin/iozone
                  dependencies: bin/* 
                  active: true
           
         - name: gpfs_mpi_io
           active: false
           batch: LSF
           modules: module load gcc mpi-openmpi
           numprocs: 32
           dataset:
                - name: mpi_io_type2_Nto1_noStrided  # MPI-IO on Scratch N procs to 1 file
                  active: true
                  exe: ./fs_test.x
                  # 10 objects of 1GB to write by each proc 
                  args:  -type 2 -strided 0 -nobj 10 -size 1073741824  -target /scratch/naranjja/mpiio_testfile -deletefile -touch 2 -check 2
                  outputs:
                     output: KaBS_%NAME%_%NUMPROCS%.out 
                
                - name: mpi_io_type1_NtoN_noStrided  # MPI-IO on Scratch N procs to 1 file
                  active: true
                  exe: ./fs_test.x
                  # 10 objects of 1GB to write by each proc 
                  args:  -type 2 -strided 0 -nobj 10 -size 1073741824  -target /scratch/naranjja/mpiio_testfile -deletefile -touch 2 -check 2
                  outputs:
                     output: KaBS_%NAME%_%NUMPROCS%.out 


      NETWORKS: 
         - name: infiniband_mpi
           batch: LSF         
           active: true
           modules:  module load gcc mpi-openmpi    
           numprocs:  16,32,64         
           dataset:           
                - name: skampi-5.0.4-r0355
                  active: true
                  exe: ./skampi
                  dependencies:  ski/*.inc , ski/skampi_coll.ski 
                  args:  -i ski/skampi_coll.ski  -o skaoutf.txt
                  outputs:
                     output: skaoutf.txt                                              
 
                - name: imb_3.2.3                            
                  active: true  
                  exe: bin/IMB-MPI1 # Full path or  Relative to the current dir
                  dependencies:   #comma separated list of  files that will be copied to the run directory ... always relative to the 'source' dir
                  args: 1>imb.output                     
                  analysis:
                        outputs: 
                                output: imb.output
                        metrics:
                                - name: pingpong_BW
                                  units: MB/secs
                                  command: cat %OUTPUT% | grep -A28 "Benchmarking PingPong" |  gawk '$1 ~ /[0-9]/'  | gawk 'BEGIN{sum=0}{if ($1>=32768) sum=sum+$4  }END{ print sum/8}'

                                - name: pingping_BW
                                  units: MB/secs
                                  command: cat %OUTPUT% | grep -A28 "Benchmarking PingPing" |  gawk '$1 ~ /[0-9]/'  | gawk 'BEGIN{sum=0}{if ($1>=32768) sum=sum+$4  }END{ print sum/8}'       

                                - name: sendrecv_BW
                                  units: MB/secs
                                  command: cat %OUTPUT% | grep -B10  "Benchmarking Exchange" | head | gawk 'BEGIN{sum=0}{if ($1>=32768) sum=sum+$6  }END{ print sum/8}'

                                - name: exchange_BW
                                  units: MB/secs
                                  command: cat %OUTPUT% | grep -B10  "Benchmarking Allreduce" | head | gawk 'BEGIN{sum=0}{if ($1>=32768) sum=sum+$6  }END{ print sum/8}'
 
                                - name: allreduce_avg_t
                                  units: usecs
                                  command: cat %OUTPUT% | grep -B10  "Benchmarking Reduce" | head | gawk 'BEGIN{sum=0}{if ($1>=32768) sum=sum+$5  }END{ print sum/8}'
 
                                - name: alltoall_avg_t
                                  units: usecs
                                  command: cat %OUTPUT% | grep -B10  "Benchmarking Bcast" | head | gawk 'BEGIN{sum=0}{if ($1>=32768) sum=sum+$5  }END{ print sum/8}'
 
                                - name: bcast_avg_t 
                                  units: usecs
                                  command: cat %OUTPUT% | grep -B10  "Benchmarking Barrier" | head | gawk 'BEGIN{sum=0}{if ($1>=32768) sum=sum+$5  }END{ print sum/8}'

      SYNTHETICS:
         - name: lapack
           active: false
         
         - name: NAS
           active: false
           dataset:
                 - name: NPB3.3.1
                   active: false
           
         - name: hpcc
           active: true
           batch: LSF         
           exe: ./hpcc 
           args: 
           modules: module load gcc atlas/3.8.4-sse3 mpi-openmpi   
           dependencies: hpccinf.txt
           dataset:
                 - name: with_atlas_32cpus
                   numprocs: 32
                   active: true                   
                   analysis:   
                        outputs:
                                hpccout: hpccoutf.txt
                        metrics:
                                - name: Procs
                                  units: ""
                                  command: cat  %HPCCOUT% | grep CommWorldProcs | gawk -F "=" '{print $2}'
                                - name: HPL
                                  units: TFlops
                                  command: cat  %HPCCOUT% | grep HPL_Tflops | gawk -F "=" '{print $2}'
                                - name: PTRANS
                                  units: GB/s
                                  command:  cat  %HPCCOUT% | grep  PTRANS_GBs | gawk -F "=" '{print $2}'
                                - name: MPIRandomAccess
                                  units: GUPs
                                  command:  cat  %HPCCOUT% | grep  MPIRandomAccess_GUPs | gawk -F "=" '{print $2}'                                  
                                - name: SingleSTREAM_Triad
                                  units: GB/s
                                  command: cat  %HPCCOUT% | grep  SingleSTREAM_Triad | gawk -F "=" '{print $2}'                                          
                                - name: FFT
                                  units: GFlop/s
                                  command: cat  %HPCCOUT% | grep  MPIFFT_Gflops | gawk -F "=" '{print $2}'                                          
                                - name: Single_DGEMM
                                  units: GFlop/s
                                  command: cat  %HPCCOUT% | grep  SingleDGEMM_Gflops| gawk -F "=" '{print $2}'
                                - name: Random_RingBandwidth
                                  units: GB/s
                                  command: cat  %HPCCOUT% | grep  RandomlyOrderedRingBandwidth_GBytes | gawk -F "=" '{print $2}'
                                - name: Random_RingLatency
                                  units: usecs
                                  command: cat  %HPCCOUT% | grep  RandomlyOrderedRingLatency_usec  | gawk -F "=" '{print $2}'
                 
                 - name: with_atlas_64cpus
                   numprocs: 64
                   active: true
                   analysis:   
                        outputs:
                                hpccout: hpccoutf.txt
                        metrics:
                                - name: Procs
                                  units: ""
                                  command: cat  %HPCCOUT% | grep CommWorldProcs | gawk -F "=" '{print $2}'
                                - name: HPL
                                  units: TFlops
                                  command: cat  %HPCCOUT% | grep HPL_Tflops | gawk -F "=" '{print $2}'
                                - name: PTRANS
                                  units: GB/s
                                  command:  cat  %HPCCOUT% | grep  PTRANS_GBs | gawk -F "=" '{print $2}'
                                - name: MPIRandomAccess
                                  units: GUPs
                                  command:  cat  %HPCCOUT% | grep  MPIRandomAccess_GUPs | gawk -F "=" '{print $2}'                                  
                                - name: SingleSTREAM_Triad
                                  units: GB/s
                                  command: cat  %HPCCOUT% | grep  SingleSTREAM_Triad | gawk -F "=" '{print $2}'                                          
                                - name: FFT
                                  units: GFlop/s
                                  command: cat  %HPCCOUT% | grep  MPIFFT_Gflops | gawk -F "=" '{print $2}'                                          
                                - name: Single_DGEMM
                                  units: GFlop/s
                                  command: cat  %HPCCOUT% | grep  SingleDGEMM_Gflops| gawk -F "=" '{print $2}'
                                - name: Random_RingBandwidth
                                  units: GB/s
                                  command: cat  %HPCCOUT% | grep  RandomlyOrderedRingBandwidth_GBytes | gawk -F "=" '{print $2}'
                                - name: Random_RingLatency
                                  units: usecs
                                  command: cat  %HPCCOUT% | grep  RandomlyOrderedRingLatency_usec  | gawk -F "=" '{print $2}'
 
      ACCEPTANCE: 
        active: false                        
...
